
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>File Firewall &mdash; ownCloud Server Administration Manual 8.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '8.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <link rel="top" title="ownCloud Server Administration Manual 8.2 documentation" href="../index.html" />
    <link rel="up" title="User Management (ES only)" href="index.html" />
    <link rel="next" title="Enabling Anonymous Uploads with Files Drop (ES Only)" href="../enterprise_files_drop/index.html" />
    <link rel="prev" title="Shibboleth Integration (Enterprise Subscription only)" href="user_auth_shibboleth.html" />
<script type="text/javascript">
(function () {
  /**
   * Patch TOC list.
   *
   * Will mutate the underlying span to have a correct ul for nav.
   *
   * @param $span: Span containing nested UL's to mutate.
   * @param minLevel: Starting level for nested lists. (1: global, 2: local).
   */
  var patchToc = function ($ul, minLevel) {
    var findA;

    // Find all a "internal" tags, traversing recursively.
    findA = function ($elem, level) {
      var level = level || 0,
        $items = $elem.find("> li > a.internal, > ul, > li > ul");

      // Iterate everything in order.
      $items.each(function (index, item) {
        var $item = $(item),
          tag = item.tagName.toLowerCase(),
          pad = 15 + ((level - minLevel) * 10);

        if (tag === 'a' && level >= minLevel) {
          // Add to existing padding.
          $item.css('padding-left', pad + "px");
          console.log(level, $item, 'padding-left', pad + "px");
        } else if (tag === 'ul') {
          // Recurse.
          findA($item, level + 1);
        }
      });
    };

    console.log("HERE");
    findA($ul);
  };

  $(document).ready(function () {
    // Add styling, structure to TOC's.
    $(".dropdown-menu").each(function () {
      $(this).find("ul").each(function (index, item){
        var $item = $(item);
        $item.addClass('unstyled');
      });
      $(this).find("li").each(function () {
        $(this).parent().append(this);
      });
    });

    // Patch in level.
    patchToc($("ul.globaltoc"), 2);
    patchToc($("ul.localtoc"), 2);

    // Enable dropdown.
    $('.dropdown-toggle').dropdown();
  });
}());
</script>

  </head>
  <body>
  

<div class="container">
  <div class="content">
    <div class="page-header">
      <h1><a href="../contents.html">ownCloud Server Administration Manual</a></h1>

    </div>
    
			<div class="row">
				<div class="span3">
					<div class="sidebar">
						<div class="well">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>
										
<li><a href="../contents.html">Table of Contents</a></li>
									</ul>
                  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">ownCloud 8.2 Server Administration Manual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">ownCloud 8.2 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new_admin.html">What&#8217;s New for Admins in ownCloud 8.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_user/index.html">User Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_files/index.html">File Sharing and Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_server/index.html">ownCloud Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_database/index.html">Database Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintenance/index.html">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operations/index.html">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Issues and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos/index.html">ownCloud Videos</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../enterprise_installation/index.html">Enterprise Subscription Installation (ES Only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_clients/index.html">Creating Branded ownCloud Clients (ES only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_external_storage/index.html">External Storage (ES only)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Management (ES only)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="user_auth_shibboleth.html">Shibboleth Integration (Enterprise Subscription only)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">File Firewall</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rule-definitions">Rule Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#available-criteria">Available Criteria</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-rule-sets">Example Rule sets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_files_drop/index.html">Enabling Anonymous Uploads with Files Drop (ES Only)</a></li>
</ul>

								</ul>
							</div>
						</div>
					</div>
				</div>
        

				<div class="span9">
					<div class="page-content">
						
  <div class="section" id="file-firewall">
<h1>File Firewall<a class="headerlink" href="#file-firewall" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>The purpose of the ownCloud Firewall is to prevent execution of ownCloud
internal code for requests that violate a set of admin-defined rules. This
allows administrators to exclude user behaviors based on many criteria,
including geographic location, size of request, app accessed, etc.</p>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The configuration of the ownCloud Enterprise Firewall is supplied by a JSON-formatted string within the ownCloud
configuration file. This string can be written to the config.php file using the admin interface within ownCloud.</p>
<p>The configuration consists of a single JSON string representing an array of objects. Each object in the array
represents a condition that must be true for the firewall to allow the request to complete.</p>
<p>When ownCloud receives a new request, the conditions in the rule set are evaluated against the criteria - such as
the user&#8217;s IP address, user agent, login credentials, etc. - generated by the request. Only if all of the conditions
are met will ownCloud&#8217;s execution be allowed to continue to fulfill the request. Otherwise, the user will receive an
HTTP 403 status error, meaning &#8220;Request forbidden&#8221;.</p>
<p>Rule sets can be constructed using multiple conditions, including Boolean operators. This can allow a request to
pass through the firewall, for example, if it meets either of two specific conditions.</p>
<div class="section" id="order-of-operations">
<h3>Order of Operations<a class="headerlink" href="#order-of-operations" title="Permalink to this headline">¶</a></h3>
<p>The order of operations during the evaluation of a rule set is important for efficiency. Properly ordering the
conditions can improve performance of the firewall.</p>
<p>When ownCloud evaluates conditions, it sequentially adds them to a stack until it reaches an operator, such as an
OR
or
AND
. Upon reaching an operator, the firewall pops the required number of conditions from the stack to evaluate the
operator. The result of the evaluation is pushed back onto the stack.</p>
<p>Any conditions that remain in the stack after all conditions and operations are added from the rule set are then
evaluated. All of these conditions must pass (as if the
AND
operator was used between each of them) for the firewall to allow the request to proceed.</p>
<p>In addition to
AND
and
OR
operations, the firewall also supports
NOT
both as an operator and a parameter to invert the result of any condition.</p>
</div>
<div class="section" id="condition-parameters">
<h3>Condition Parameters<a class="headerlink" href="#condition-parameters" title="Permalink to this headline">¶</a></h3>
<p>Within each condition definition in a rule set, it is possible to define parameters that limit the condition. For
example, the &#8220;subnet&#8221; condition has a parameter that allows an admin to specify the range of the subnet in bits.
Other conditions have similar parameters, and conditions may have none or multiple parameters.</p>
<p><em>API Note:</em>
In the current revision of the firewall, the parameters and description of a condition are defined within the
Rule
class that implements that condition. In future revisions of the firewall, the types of the parameter values that are defined within the
Rule
classes may be enforced via the admin interface.</p>
</div>
</div>
<div class="section" id="rule-definitions">
<h2>Rule Definitions<a class="headerlink" href="#rule-definitions" title="Permalink to this headline">¶</a></h2>
<p>Every defined rule must include a type. There are two types of rules that are applicable to firewalls: Conditions
and Operators. Conditions compare request criteria to specific pre-set values. Their results determine whether the
firewall allows the pass-through of a request. Operators combine the results of conditions, and allow a rule set to
accommodate different types of requests under different circumstances.</p>
<div class="section" id="conditions">
<h3>Conditions<a class="headerlink" href="#conditions" title="Permalink to this headline">¶</a></h3>
<p>The type of a condition is &#8220;condition&#8221;. Conditions must have a &#8220;check&#8221; value that describes the type of check that
will be performed if the condition is evaluated. The &#8220;check&#8221; value must be provided in the rule set as all lowercase.</p>
<p>Any condition may have a &#8220;negate&#8221; value. If the &#8220;negate&#8221; value is true, then the result of the condition will
be negated. For example, to block a subnet of IP addresses, use the CIDR rule to select that subnet, then negate
the rule so that requests from that subnet fail. It is also possible to follow any condition with a
NOT
operator to perform this same function.</p>
<p>Any condition may also have a &#8220;failmessage&#8221; or &#8220;passmessage&#8221; parameter. The value of these parameters is saved to
the ownCloud log in the case that the condition is executed and fails or passes, respectively. Note that adding t
hese parameters to a condition can have a
<em>significant</em>
impact on performance, as such, these parameters should only be used while debugging firewall rule sets.</p>
<p>The following is a list of checks that are supported in the firewall, along with the parameters they require.</p>
<div class="section" id="cidr">
<h4>CIDR<a class="headerlink" href="#cidr" title="Permalink to this headline">¶</a></h4>
<p>A CIDR condition allows only those requests that originate from an IP address that matches a CIDR mask.</p>
<p><em>Parameters</em>
<em>:</em></p>
<p>cidr</p>
<p>The CIDR address mask, in a format similar to
192.168.1.0/24</p>
<p><em>Example:</em></p>
<p>This condition uses the &#8220;negate&#8221; parameter to ensure that the request does not come from a specific subnet:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
<span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;cidr&quot;</span><span class="p">,</span>
<span class="nt">&quot;cidr&quot;</span><span class="p">:</span> <span class="s2">&quot;117.22.0.0/15&quot;</span><span class="p">,</span>
<span class="nt">&quot;negate&quot;</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="regex">
<h4>Regex<a class="headerlink" href="#regex" title="Permalink to this headline">¶</a></h4>
<p>A Regex condition allows only those requests that successfully match a regular expression to a specific request criteria.</p>
<p><em>Parameters:</em></p>
<p>regex</p>
<p>The regular expression to use in the comparison. This regular expression must be delimited. For example:
#p#</p>
<p>criteria</p>
<p>The name of the criteria to match to the regular expression.</p>
<p><em>Example:</em></p>
<p>This condition checks to ensure that the request criteria contains the letter &#8220;p&#8221;:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
<span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;regex&quot;</span><span class="p">,</span>
<span class="nt">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;#p#&quot;</span><span class="p">,</span>
<span class="nt">&quot;criteria&quot;</span><span class="p">:</span> <span class="s2">&quot;request&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="subnet">
<h4>subnet<a class="headerlink" href="#subnet" title="Permalink to this headline">¶</a></h4>
<p>A Subnet condition allows a request only if the request originates from within a certain number of significant bits of the server&#8217;s IP address. For example, to allow requests from the subnet 192.168.1.0 through 192.168.1.255, the &#8220;bits&#8221; parameter should be set to 24, which includes the first three octets of the IP address.</p>
<p><em>Parameters:</em></p>
<p>bits</p>
<p>The number of significant bits that are required to match the server&#8217;s IP address for a request to be passed.</p>
<p><em>Example:</em></p>
<p>This condition checks to ensure that the request originates on the same subnet as the server:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
<span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;subnet&quot;</span><span class="p">,</span>
<span class="nt">&quot;bits&quot;</span><span class="p">:</span> <span class="mi">24</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="upload">
<h4>upload<a class="headerlink" href="#upload" title="Permalink to this headline">¶</a></h4>
<p>An Upload condition allows a request only if it is attempting an upload. Note that this condition can be useful in two ways:</p>
<ol class="arabic simple">
<li>Require a request to be an upload before requiring another condition, such as a size restriction.</li>
<li>Require a request
<em>not</em>
to be an upload (by adding the
negate
parameter) as an alternative in an
OR
operation.</li>
</ol>
<p><em>Parameters: None.</em></p>
<p><em>Example:</em></p>
<p>This condition uses the &#8220;negate&#8221; parameter to ensure that the request is not an upload:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
<span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;upload&quot;</span><span class="p">,</span>
<span class="nt">&quot;negate&quot;</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="verb">
<h4>Verb<a class="headerlink" href="#verb" title="Permalink to this headline">¶</a></h4>
<p>A Verb condition allows a request only if the request uses a specific HTTP verb.</p>
<p><em>Parameters:</em></p>
<p>verb</p>
<p>A comma-separated list of verbs that will pass this condition. Note that HTTP verbs are case-sensitive and are usually required to be in upper case.</p>
<p><em>Example:</em></p>
<p>This condition checks to ensure that the request method was either a
GET
or
PUT
:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
<span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;verb&quot;</span><span class="p">,</span>
<span class="nt">&quot;verb&quot;</span><span class="p">:</span> <span class="s2">&quot;GET,POST&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="loggedin">
<h4>Loggedin<a class="headerlink" href="#loggedin" title="Permalink to this headline">¶</a></h4>
<p>A LoggedIn condition allows a request only if the user is logged in.</p>
<p><em>No parameters.</em></p>
<p><em>Example:</em></p>
<p>This condition uses the negate parameter to require that the user is
<em>not</em>
logged in:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
<span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;loggedin&quot;</span><span class="p">,</span>
<span class="nt">&quot;negate&quot;</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="usergroup">
<h4>Usergroup<a class="headerlink" href="#usergroup" title="Permalink to this headline">¶</a></h4>
<p>A UserGroup condition allows a request only if the user is a member of the specified group or groups.</p>
<p><em>Parameters:</em></p>
<p>group</p>
<p>A comma-separated list of groups, of which the user must be a member of at least one.</p>
<p><em>Example:</em></p>
<p>This condition requires a user to be in the &#8220;admin&#8221; group:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
<span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;usergroup&quot;</span><span class="p">,</span>
<span class="nt">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="time">
<h4>Time<a class="headerlink" href="#time" title="Permalink to this headline">¶</a></h4>
<p>A Time condition allows a request only if the request is made within a specific time range. The check is performed against GMT. If the end time is before the begin time, then the range spans overnight.</p>
<p><em>Parameters:</em></p>
<p>begin</p>
<p>The beginning of the time range, in the format HH:MM. PM times are expressed in numbers greater than 12.</p>
<p>end</p>
<p>The end of the time range, in the format HH:MM. PM times are expressed in numbers greater than 12.</p>
<p><em>Example:</em></p>
<p>This condition requires a request to occur between 9am and 5pm GMT:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
<span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
<span class="nt">&quot;begin&quot;</span><span class="p">:</span> <span class="s2">&quot;9:00&quot;</span><span class="p">,</span>
<span class="nt">&quot;end&quot;</span><span class="p">:</span> <span class="s2">&quot;17:00&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="sizeup">
<h4>Sizeup<a class="headerlink" href="#sizeup" title="Permalink to this headline">¶</a></h4>
<p>A SizeUp condition allows a request only if the size of the request is under a specific limit. This limits the amount of data that can be transferred to the server, and can prevent unwanted large files from being uploaded. This rule is not guaranteed to prevent a client from transferring (and the server from receiving) the data prior to the rule taking effect, but under some circumstances (particularly PUT
requests like those initiated via WebDAV with a properly configured server) the transfer of data may be prevented.</p>
<p><em>Parameters:</em></p>
<p>limit</p>
<p>The maximum number of bytes that are allowed to be transferred in the request.</p>
<p><em>Example:</em></p>
<p>This condition requires all transfers to the server to be less than about 100kb.</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
<span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;sizeup&quot;</span><span class="p">,</span>
<span class="nt">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">100000</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="operators">
<h3>Operators<a class="headerlink" href="#operators" title="Permalink to this headline">¶</a></h3>
<p>The
type of an operator is &#8220;operator&#8221;. Operators must also have an &#8220;operator&#8221; value that describes the type of operation that will be performed on the conditions currently in the stack. The &#8220;operator&#8221; value must be provided in the rule set as all lowercase.</p>
<p>Operators may also include the &#8220;count&#8221; parameter, which defines an alternate number of conditions to pop from the stack. This can be useful for efficiently combining multiple operations in a more complicated rule set.</p>
<p>The following is a list of operators that are supported in the firewall.</p>
<div class="section" id="and">
<h4>and<a class="headerlink" href="#and" title="Permalink to this headline">¶</a></h4>
<p>The
AND
operator pops two conditions (unless a count parameter is supplied) from the stack. Each condition is evaluated until one evaluates to
false
or there are no more conditions to evaluate (which results in a
true
response). The result of the operator is pushed onto the stack.</p>
<p>The
AND
operator short-circuits if any of the conditions it pops evaluates to
false
. The conditions pushed onto the stack before the
AND
operator should be optimized so that the most likely to return
<em>false</em>
is the first in the order executed. This will prevent the others from being executed, thus saving execution time.</p>
</div>
<div class="section" id="or">
<h4>Or<a class="headerlink" href="#or" title="Permalink to this headline">¶</a></h4>
<p>The
OR
operator pops two conditions (unless a count parameter is supplied) from the stack. Each condition is evaluated until one evaluates to
true
or there are no more conditions to evaluate (which results in a
false
response). The result of the operator is pushed onto the stack.</p>
<p>The
OR
operator short-circuits if any of the conditions it pops evaluates to
true
. The conditions pushed onto the stack before the
OR
operator should be optimized so that the most likely to return
true
is the first in the order executed. This will prevent the others from being executed, thus saving execution time.</p>
</div>
<div class="section" id="not">
<h4>Not<a class="headerlink" href="#not" title="Permalink to this headline">¶</a></h4>
<p>The
NOT
operator pops one condition from the stack. The &#8220;negate&#8221; property of this condition is toggled, then the condition is pushed back onto the stack. The
NOT
operator does not force the condition it modifies to be evaluated.</p>
</div>
<div class="section" id="log">
<h4>log<a class="headerlink" href="#log" title="Permalink to this headline">¶</a></h4>
<p>The
LOG
operator pops one condition from the stack and evaluates it. The result of the evaluated condition is output to the ownCloud log along with the &#8220;message&#8221; parameter of the operator.</p>
<p>The
LOG
operator does not affect the outcome of the rule set evaluation, but it may execute conditions that would not otherwise be executed due to operator short-circuiting, which will affect performance. Saving log entries to a file on every request can have a
<em>significant</em>
impact on performance, as such, this operator should only be used while debugging firewall rule sets.</p>
</div>
</div>
</div>
<div class="section" id="available-criteria">
<h2>Available Criteria<a class="headerlink" href="#available-criteria" title="Permalink to this headline">¶</a></h2>
<p>There are some conditions that allow the administrator to set specific criteria on which they act. The following is a list of criteria that is collected by the firewall to pass into the conditions for evaluation.</p>
<div class="section" id="user-agent">
<h3>User-agent<a class="headerlink" href="#user-agent" title="Permalink to this headline">¶</a></h3>
<p>The literal user-agent string supplied by the client</p>
</div>
<div class="section" id="agent">
<h3>agent<a class="headerlink" href="#agent" title="Permalink to this headline">¶</a></h3>
<p>A translated user-agent string that may include:</p>
<div class="section" id="desktop">
<h4>desktop<a class="headerlink" href="#desktop" title="Permalink to this headline">¶</a></h4>
<p>Indicating a desktop sync client.</p>
</div>
<div class="section" id="ios">
<h4>ios<a class="headerlink" href="#ios" title="Permalink to this headline">¶</a></h4>
<p>Indicating the ownCloud IOS client.</p>
</div>
<div class="section" id="android">
<h4>android<a class="headerlink" href="#android" title="Permalink to this headline">¶</a></h4>
<p>Indicating the ownCloud Android client.</p>
</div>
<div class="section" id="webdav">
<h4>webdav<a class="headerlink" href="#webdav" title="Permalink to this headline">¶</a></h4>
<p>Indicating a webdav request.</p>
</div>
<div class="section" id="public">
<h4>Public<a class="headerlink" href="#public" title="Permalink to this headline">¶</a></h4>
<p>Indicating a shared public URL.</p>
</div>
</div>
<div class="section" id="request-url">
<h3>Request-url<a class="headerlink" href="#request-url" title="Permalink to this headline">¶</a></h3>
<p>The requested URI.</p>
</div>
<div class="section" id="request">
<h3>request<a class="headerlink" href="#request" title="Permalink to this headline">¶</a></h3>
<p>Same as request-uri</p>
</div>
<div class="section" id="remote-addr">
<h3>Remote-addr<a class="headerlink" href="#remote-addr" title="Permalink to this headline">¶</a></h3>
<p>The remote IP address of the user.</p>
</div>
<div class="section" id="ip">
<h3>IP<a class="headerlink" href="#ip" title="Permalink to this headline">¶</a></h3>
<p>Same as remote-addr</p>
</div>
<div class="section" id="id1">
<h3>time<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>UTC timestamp.</p>
</div>
<div class="section" id="server-time">
<h3>Server-time<a class="headerlink" href="#server-time" title="Permalink to this headline">¶</a></h3>
<p>Server time zone timestamp</p>
</div>
<div class="section" id="user-time">
<h3>User-time<a class="headerlink" href="#user-time" title="Permalink to this headline">¶</a></h3>
<p>User time zone timestamp</p>
</div>
<div class="section" id="user">
<h3>user<a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h3>
<p>The ownCloud OC_User object representing the logged-in user</p>
</div>
<div class="section" id="groups">
<h3>groups<a class="headerlink" href="#groups" title="Permalink to this headline">¶</a></h3>
<p>The ownCloud group ids that the current user belongs to</p>
</div>
<div class="section" id="app">
<h3>app<a class="headerlink" href="#app" title="Permalink to this headline">¶</a></h3>
<p>The name of the app that the request pertains to</p>
</div>
<div class="section" id="appfile">
<h3>appfile<a class="headerlink" href="#appfile" title="Permalink to this headline">¶</a></h3>
<p>The file of the app that was requested</p>
</div>
<div class="section" id="method">
<h3>method<a class="headerlink" href="#method" title="Permalink to this headline">¶</a></h3>
<p>The HTTP verb used for the request</p>
</div>
</div>
<div class="section" id="example-rule-sets">
<h2>Example Rule sets<a class="headerlink" href="#example-rule-sets" title="Permalink to this headline">¶</a></h2>
<p>Here is a sample rule set that allows requests to be uploads only if they are within the server&#8217;s subnet or using the iOS client:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">[{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
    <span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;upload&quot;</span><span class="p">,</span>
    <span class="nt">&quot;negate&quot;</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
    <span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;subnet&quot;</span><span class="p">,</span>
    <span class="nt">&quot;bits&quot;</span><span class="p">:</span> <span class="mi">24</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;condition&quot;</span><span class="p">,</span>
    <span class="nt">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;regex&quot;</span><span class="p">,</span>
    <span class="nt">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;#^ios$#&quot;</span><span class="p">,</span>
    <span class="nt">&quot;criteria&quot;</span><span class="p">:</span> <span class="s2">&quot;agent&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;operator&quot;</span><span class="p">,</span>
    <span class="nt">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;or&quot;</span><span class="p">,</span>
    <span class="nt">&quot;count&quot;</span><span class="p">:</span> <span class="mi">3</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The following example shows a rule set that allows only users in the “admin” group to upload files to ownCloud:</p>
<img alt="../_images/100000000000023F000000F8D2CD2E60.png" src="../_images/100000000000023F000000F8D2CD2E60.png" style="width: 5.9898in; height: 2.5835in;" />
<img alt="../_images/100000000000023100000082EE8AC471.png" src="../_images/100000000000023100000082EE8AC471.png" style="width: 5.8437in; height: 1.3543in;" />
<p>The following rule set may be used to block uploads from a specific IP range (58.14.0.0/24 in this case).
This can be useful to block uploads from less desirable countries:</p>
<img alt="../_images/100000000000033300000106C232E69B.png" src="../_images/100000000000033300000106C232E69B.png" style="width: 6.5in; height: 2.0791in;" />
<img alt="../_images/100000000000030C00000070A51C0EF4.png" src="../_images/100000000000030C00000070A51C0EF4.png" style="width: 6.5in; height: 0.9335in;" />
</div>
</div>


					</div>
				</div>
			</div>
    
  </div>
</div>
  </body>
</html>